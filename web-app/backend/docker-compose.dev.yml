services:
  backend:
    build:
      context: .
      dockerfile: deployment/docker/Dockerfile.dev
    container_name: raw2md-backend-dev
    env_file:
      - ../../.env
    ports:
      - "5000:5000"
    volumes:
      # Mount source code để có thể edit và reload ngay
      - .:/app
      - /app/__pycache__
      - /app/**/__pycache__
      # Mount data directories từ web-app/data (theo config) vào /app/data trong container
      - ../data:/app/data
      - ./logs:/app/logs
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - API_HOST=0.0.0.0
      - API_PORT=5000
      - PYTHONPATH=/app:/app/../raw2md_agent
      - DATA_DIR=/app/data  # Chỉ định rõ data directory trong Docker
      - OCR_ENABLED=true
      - TESSERACT_PATH=/usr/bin/tesseract
      - OCR_LANG=vie+eng
      - MAX_FILE_SIZE_MB=100
      - LOG_LEVEL=DEBUG
      - FLASK_SKIP_DOTENV=1
      # Để cho phép truy cập từ bên ngoài, set ALLOW_ALL_CORS=true
      - ALLOW_ALL_CORS=true
    command: python app.py  # Dùng Flask dev server thay vì gunicorn
    stdin_open: true  # Cho phép attach vào container
    tty: true  # Interactive mode
    restart: unless-stopped

